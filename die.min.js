if(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},"undefined"==typeof dieunah)var dieunah=new function(){this.nUnidades=0,this.nExamenes=0,this.urlRoot="",this.lista=[],this.dias=["Dom","Lun","Mar","Mié","Jue","Vie","Sab"],this.meses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],this.yaProcesado=!1,this.yaCalendarizado=[!0,!0],this.puedeEditar=!1,this.bEditando=!1,this.sesskey=null,this.TiposActividadesDisponibles=[],this.idCurso=window.location.pathname.match(/\/\d+\//)[0].match(/\d+/)[0];var t=this;this.bloquear_pantalla=function(t){void 0==t&&(t="Por favor espere..."),$.blockUI({css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"},message:t})},this.lista_actividades=function(){var i=String(window.location.href.match(/.*file.php/));return t.urlRoot=i.substring(0,i.length-9),$.get(t.urlRoot+"/course/view.php?id="+t.idCurso+"&parametroDEGT=quitar",function(i,e){var a=new RegExp("id=([0-9]+)"),s=/\/mod\/(\w+)\//i;"error"==e?alert("Problema con la conexión de internet (error: 1)"):"timeout"==e?alert("Problema con la conexión de internet (error: 2)"):"parsererror"==e&&alert("Problema con el formato de conexión de internet (error: 3)"),resultado=i,t.lista.push({id:"u0t0a0_participantes",modID:0,modTipo:0,titulo:"Participantes",url:t.urlRoot+"/user/index.php?id="+t.idCurso}),t.lista.push({id:"u0t0a0_calificaciones",modID:0,modTipo:0,titulo:"Calificaciones",url:t.urlRoot+"/grade/report/index.php?id="+t.idCurso}),t.lista.push({id:"u0t0a0_novedades",modID:0,modTipo:0,titulo:$('li[id=section-0] a:contains("Novedades")',i).text(),url:$('li[id=section-0] a:contains("Novedades")',i).attr("href")}),t.lista.push({id:"u0t0a0_consultas",modID:0,modTipo:0,titulo:$('li[id=section-0] a:contains("Consulta")',i).text(),url:$('li[id=section-0] a:contains("Consulta")',i).attr("href")}),t.lista.push({id:"u0t0a0_presentacion",modID:0,modTipo:0,titulo:$('li[id=section-0] a:contains("Presenta")',i).text(),url:$('li[id=section-0] a:contains("Presenta")',i).attr("href")}),t.lista.push({id:"u0t0a0_cafeteria",modID:0,modTipo:0,titulo:$('li[id=section-0] a:contains("Cafe")',i).text(),url:$('li[id=section-0] a:contains("Cafe")',i).attr("href")}),t.lista.push({id:"u0t0a0_salir",modID:0,modTipo:0,titulo:"Salir",url:t.urlRoot+"/my/"}),$("li[id^=section-]",i).each(function(){if("section-0"==$(this).attr("id"))return!0;var i=$(".summary",this).text().trim().toLowerCase().match(/unidad\s*\d+/);if(null===i){var i=$(".summary",this).text().trim().toLowerCase().match(/unidad/);null===i||t.nUnidades++}else nUnidad=parseInt(i[0].match(/\d+/)),t.nUnidades=nUnidad;var e=0,n=1;$("li",this).each(function(){if(0==$(".contentwithoutlink ",this).length&&0==$("a.dimmed",this).length){var i="u"+t.nUnidades+"t"+e+"a"+n;if(0==$('a:contains("_noact")',this).length){var d=s.exec($("a",this).attr("href"));0==$('a:contains("Examen")',this).length&&0==$('a:contains("Recupera")',this).length&&0==$('a:contains("Repos")',this).length?(n++,t.lista.push({id:i,modID:a.exec($("a",this).attr("href"))[1],modTipo:d[1],titulo:$(this).text().trim(),url:$("a",this).attr("href"),puntos:0,fInicio:0,fFinal:0})):(t.nExamenes++,t.lista.push({id:"u0t0a0_e"+t.nExamenes,modID:a.exec($("a",this).attr("href"))[1],modTipo:d[1],titulo:$(this).text().trim(),url:$("a",this).attr("href"),puntos:0,fInicio:0,fFinal:0}))}}else $(".contentwithoutlink ",this).length>0&&0==$("a.dimmed",this).length&&(e=parseInt($(this).text().match(/\d+/)[0]),n=1)})}),setTimeout($.unblockUI,100),t.yaProcesado=!0,t.Calendarizar(),$("body").append('<div id="hotpt85469" style="background-color:#000;width:10px; height:10px; display:block; position:absolute; bottom:0px; left:0px"></div>'),$("#hotpt85469").click(function(i){i.shiftKey&&i.ctrlKey&&i.altKey&&$.colorbox({html:t.HTML_lista_actividades()})})},"html"),t.lista},this.Calendarizar=function(){t.yaCalendarizado=[!0,!0],$.get(t.urlRoot+"/report/editdates/index.php?id="+t.idCurso+"&activitytype=assign",function(e){t.sesskey=$("input[name='sesskey']",e).attr("value"),t.ObtenerFechas(e);var a=[];for($("form[id=activitytypeform] div select option",e).each(function(){"selected"!=$(this).attr("selected")&&a.push($(this).attr("value"))}),i=0;i<a.length;i++)"resource"!=a[i]&&"label"!=a[i]&&"url"!=a[i]&&(t.yaCalendarizado.push(!0),$.get(t.urlRoot+"/report/editdates/index.php?id="+t.idCurso+"&activitytype="+a[i],function(i){t.ObtenerFechas(i),t.yaCalendarizado.pop()},"html"));t.TiposActividadesDisponibles=a,t.TiposActividadesDisponibles.splice(t.TiposActividadesDisponibles.indexOf(""),1),t.yaCalendarizado.pop()},"html"),$.get(t.urlRoot+"/grade/report/user/index.php?id="+t.idCurso,function(i){var e,a=/(\d?\.?\d+$)/,s=new RegExp("id=([0-9]+)");$("th[class*='item']",i).each(function(){var n=s.exec($("a",this).attr("href"));$("td[headers$='"+$(this).attr("id")+" range']",i).each(function(){var i=$(this).text();e=a.exec(i);var s=t.actividad_por_modID(n[1]);0!=s&&(t.lista[s].puntos=e[1])})}),t.yaCalendarizado.pop()},"html")},this.CalendarizacionLista=function(){return 0==t.yaCalendarizado.length?!0:!1},this.ObtenerFechas=function(i){var e=new RegExp("_([0-9]+)_"),a=new RegExp("_(allowsubmissionsfromdate|duedate|cutoffdate|timeopen|timeclose|assesstimestart|assesstimefinish|submissionstart|submissionend|available|deadline|assessmentstart|assessmentend)");if($('div[id^="fitem_id_date_mod_"]',i).each(function(){t.puedeEditar=!0;var i=String($(this).attr("id")).substring(6),s="";if(s=null==a.exec(i)[1]?!1:a.exec(i)[1],"checked"!==$('input[id="'+i+'_enabled"]',this).attr("checked")&&"assesstimestart"!=s&&"assesstimefinish"!=s)return!0;var n=$('select[id="'+i+'_month"] option[selected=selected]',this).attr("value");n=n+"/"+$('select[id="'+i+'_day"] option[selected=selected]',this).attr("value"),n=n+"/"+$('select[id="'+i+'_year"] option[selected=selected]',this).attr("value"),n=n+" "+$('select[id="'+i+'_hour"] option[selected=selected]',this).attr("value"),n=n+":"+$('select[id="'+i+'_minute"] option[selected=selected]',this).attr("value");var d=new Date(n),o=t.actividad_por_modID(e.exec(i)[1]);if(o&&s)switch(s){case"allowsubmissionsfromdate":t.lista[o].fInicio=d;break;case"timeopen":t.lista[o].fInicio=d;break;case"assesstimestart":t.lista[o].fInicio=d;break;case"duedate":t.lista[o].fFinal=d;break;case"timeclose":t.lista[o].fFinal=d;break;case"assesstimefinish":t.lista[o].fFinal=d;break;case"cutoffdate":}}),!t.puedeEditar){var s=/id_date_mod_(\d+)_(\w+)_(day|month|year|hour|minute)">[^<]+<\/label>(\d+|\w+)/gi,n=/checked="checked"/i;$("div[class^=felement]",i).each(function(){for(var i=n.exec($(this).html()),e=new Date,a=0,d="";null!=(m=s.exec($(this).html()));){if(m.index===s.lastIndex&&s.lastIndex++,a=m[1],d=m[2],!i&&"assesstimestart"!=d&&"assesstimefinish"!=d)return!0;switch(m[3]){case"day":e.setDate(m[4]);break;case"month":e.setMonth(t.strMes_nMes(m[4]));break;case"year":e.setFullYear(m[4]);break;case"hour":e.setHours(m[4]);break;case"minute":e.setMinutes(m[4])}}var o=t.actividad_por_modID(a);if(o&&a>0)switch(d){case"allowsubmissionsfromdate":t.lista[o].fInicio=e;break;case"timeopen":t.lista[o].fInicio=e;break;case"assesstimestart":t.lista[o].fInicio=e;break;case"duedate":t.lista[o].fFinal=e;break;case"timeclose":t.lista[o].fFinal=e;break;case"assesstimefinish":t.lista[o].fFinal=e;break;case"cutoffdate":}})}return!0},this.strMes_nMes=function(t){var i=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre","ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic","january","february","march","april","may","june","july","august","september","october","november","december"];return i.indexOf(String(t).toLowerCase())%12},this.HTML_lista_actividades=function(){var e="";for(e+="<table border='1' align='center' cellpadding='5' cellspacing='0' class='tablactividades' width='800px'>",e+="<tr><td>id</td><td>modID</td><td>tipo Mod</td><td>Unidad</td><td>Tema</td><td>Actividad</td><td>Titulo</td><td>Url</td><td>Puntos</td><td>Inicio</td><td>Fin</td></tr>",i=0;i<t.lista.length;i++)e+="<tr><td>"+t.lista[i].id+"</td><td>"+t.lista[i].modID+"</td><td>"+t.lista[i].modTipo+"</td><td>"+t.lista[i].id.match(/u\d+/)+"</td><td>"+t.lista[i].id.match(/t\d+/)+"</td><td>"+t.lista[i].id.match(/a\d+/)+"</td><td>"+t.lista[i].titulo+"</td><td>"+t.lista[i].url+"</td><td>"+t.lista[i].puntos+"</td><td>"+t.lista[i].fInicio+"</td><td>"+t.lista[i].fFinal+"</td></tr>";return e+="</table>"},this.actividad_por_modID=function(e){for(i=0;i<t.lista.length;i++)if(t.lista[i].modID==e)return i;return!1},this.actividad_por_id=function(e){for(i=0;i<t.lista.length;i++)if(t.lista[i].id==e)return t.lista[i];return!1},this.HTML_actividad_por_id=function(t){var i=this.actividad_por_id(t),e="";return e=0==i?"ERROR: "+t+" actividad no presente":"<a href='#' onClick='parent.$.colorbox({href:\""+i.url+'",width:"95%", height:"95%", iframe:true}); return false;\'>'+i.titulo+"</a>"},this.actividades_de_tema=function(e,a){var s=[];for(i=0;i<t.lista.length;i++){var n="u"+e+"t"+a,d=t.lista[i].id;d.substr(0,n.length)==n&&s.push(t.lista[i])}return 0==s.length?!1:s},this.LimpiarActividadMoodle=function(){$(".cboxIframe").contents().find("#page-header").css("display","none"),$(".cboxIframe").contents().find(".navbar-inner").css("display","none"),$(".cboxIframe").contents().find("#block-region-side-pre").css("display","none"),$(".cboxIframe").contents().find("#block-region-side-post").css("display","none"),$(".cboxIframe").contents().find("#region-main").css("width","100%"),$(".cboxIframe").contents().find("#page-footer").css("display","none"),$(".cboxIframe").contents().find("footer").css("display","none"),$(".cboxIframe").contents().find(".content-header").css("display","none"),$(".cboxIframe").contents().find(".navbar navbar-default navbar-fixed-top").css("display","none"),$(".cboxIframe").contents().find("#main-container").css("margin-left","0px"),$(".cboxIframe").contents().find("#sidebar").css("display","none"),$(".cboxIframe").contents().find(".col-md-4").css("display","none"),$(".cboxIframe").contents().find(".breadcrumb breadcrumb-top").css("display","none")},this.HTML_actividades_de_tema=function(t,e,a){var s=this.actividades_de_tema(t,e);"undefined"==typeof a&&(a=[]);var n="";if(n="<table border='0' align='center' cellpadding='10' cellspacing='10' class='tablactividades'>",0==s)n+="<tr><td>No hay actividades en este tema.</td></tr>";else for(i=0;i<s.length;i++)n+="<tr><td><a href='#' onClick='parent.$.colorbox({href:\""+s[i].url+'",width:"95%", height:"95%", iframe:true,onComplete:function(){ parent.$( ".cboxIframe" ).load(function(){parent.dieunah.LimpiarActividadMoodle(".cboxIframe")});}});return false;\'>',n+=s[i].titulo,n+="</a></td></tr>";if(a.length>0)for(j=0;j<a.length;j++)n+="<tr><td><a href='#' onClick='parent.$.colorbox({href:\"../unidad_"+t+"/t"+e+"_autoevaluacion"+(j+1)+'.html",width:"95%", height:"95%", iframe:true}); return false;\'>',n+=a[j],n+="</a></td></tr>";return n+="</table>"},this.GenerarCalendario=function(){var i="",e=0,a=0,s=0,n="",d="",o=0,r=0,l=0,c=0,h=[],u=[];for(i='<table class="tabla_calendario" border="0" cellpadding="10px" cellspacing="0" align="center"><tr style="text-align:center" class="titulo"><td>Unidad</td><td>Tema</td><td>Actividad</td><td>Valor</td><td>Fecha</td></tr>',_=0;_<this.lista.length;_++){e=parseInt(String(this.lista[_].id.match(/u\d+/)).substring(1)),a=_<this.lista.length-1?parseInt(String(this.lista[_+1].id.match(/u\d+/)).substring(1)):e+1,o=parseInt(String(this.lista[_].id.match(/t\d+/)).substring(1));var p="",f="",m=!1,b=!1;0===this.lista[_].fInicio||void 0===this.lista[_].fInicio?p=(t.bEditando?"<div class='rotuloini des'>Disponible desde:</div><input class='inicio_oculto' id='fecha_ini_"+_+"'></input>":"")+t.FechaCadena(this.lista[_].fInicio):(m=!0,p=t.bEditando?"<input tipomod='"+this.lista[_].modTipo+"' class='inicio_visible' id='fecha_ini_"+_+"' value='"+t.FechaCadena(this.lista[_].fInicio,!0)+"'></input>":"<div class='rotuloini'>Disponible desde:</div>"+t.FechaCadena(this.lista[_].fInicio)),0===this.lista[_].fFinal||void 0===this.lista[_].fFinal?f=(t.bEditando?"<div class='rotulofin des'>Fecha máxima:</div><input class='final_oculto' id='fecha_fin_"+_+"'></input>":"")+t.FechaCadena(this.lista[_].fFinal):(b=!0,f=t.bEditando?"<input tipomod='"+this.lista[_].modTipo+"' class='final_visible' id='fecha_fin_"+_+"' value='"+t.FechaCadena(this.lista[_].fFinal,!0)+"'></input>":"<div class='rotulofin'>Fecha máxima:</div>"+t.FechaCadena(this.lista[_].fFinal));var g="<table width='100%' class='calen' id='id"+this.lista[_].modID+"'><tr><td>"+p+"</td><td width='10px'>"+(t.bEditando?'<img style="display:'+(m?"inline":"none")+'" class="del_ini" id="ini_id_'+_+'" src="js/delete16.png"/>':"")+"</td></tr><td>"+f+"</td><td>"+(t.bEditando?'<img style="display:'+(b?"inline":"none")+'" class="del_fin" id="fin_id_'+_+'" src="js/delete16.png"/>':"")+"</td></tr></table>";if(e>s&&(r=0),0!=e)r++,1==r?(l>1&&(h.push("u"+s+"t"+c),u.push(l)),l=1,c=o,n="Unidad "+e+"</td><td"+(e%2==1?" class='tema_impar' ":" class='tema_par' ")+" id='u"+e+"t"+o+"'>Tema "+o+"</td><td> <a href='"+this.lista[_].url+"'>"+this.lista[_].titulo+"</a><br>"+(t.bEditando&&"forum"==this.lista[_].modTipo?"<span style='color:#FF0000'>Es obligatorio en los Foros colocar fecha de inicio y fecha final</span>":"")+"</td><td align='center'>"+(0==this.lista[_].puntos?"No se califica":this.lista[_].puntos)+"</td><td style='white-space:nowrap;'>"+g+"</td></tr>"):(c==o?(d+="<tr"+(e%2==1?" class='impar' ":" class='par' ")+"><td> <a href='"+this.lista[_].url+"'>"+this.lista[_].titulo+"</a><br>"+(t.bEditando&&"forum"==this.lista[_].modTipo?"<span style='color:#FF0000'>Es obligatorio en los Foros colocar fecha de inicio y fecha final</span>":"")+"</td><td align='center'>"+(0==this.lista[_].puntos?"No se califica":this.lista[_].puntos)+"</td><td style='white-space:nowrap;'>"+g+"</td></tr>",l++):(l>=2&&(h.push("u"+e+"t"+c),u.push(l)),d+="<tr"+(e%2==1?" class='impar' ":" class='par' ")+"><td"+(e%2==1?" class='tema_impar' ":" class='tema_par' ")+" id='u"+e+"t"+o+"' rowspan='1'>Tema "+o+"</td><td> <a href='"+this.lista[_].url+"'>"+this.lista[_].titulo+"</a><br>"+(t.bEditando&&"forum"==this.lista[_].modTipo?"<span style='color:#FF0000'>Es obligatorio en los Foros colocar fecha de inicio y fecha final</span>":"")+"</td><td align='center' style='white-space:nowrap;'>"+this.lista[_].puntos+"</td><td>"+g+"</td></tr>",l=1),_==t.lista.length-1&&l>=2&&(h.push("u"+e+"t"+c),u.push(l)),c=o),s=e,a!=e&&(i+="<tr"+(e%2==1?" class='impar' ":" class='par' ")+"><td "+(e%2==1?" class='unidad_impar' ":" class='unidad_par' ")+" rowspan='"+r+"'>"+n+d,d="");else{var v=parseInt(String(this.lista[_].id.match(/e\d+/)).substring(1));v>0&&(i+="<tr class='examen'><td colspan='3' class='exa_tit'><a href='"+this.lista[_].url+"'>"+this.lista[_].titulo+"</a></td><td align='center'>"+(0==this.lista[_].puntos?"No se califica":this.lista[_].puntos)+"</td><td style='white-space:nowrap;'>"+g+"</td></tr>")}}i+="</table>";for(var _=0;_<h.length;_++)i=i.replace("id='"+h[_]+"'","rowspan='"+u[_]+"'");return i},this.FechaCadena=function(i,e){e=void 0==e?!1:!0;var a="";return a=i&&!e?"<span class='dia'>"+t.dias[i.getDay()]+"</span>, "+i.getDate()+" "+t.meses[i.getMonth()]+" <span class='agno'>"+i.getFullYear()+"</span> - <span class='hora'>"+(0==i.getHours()?"00":i.getHours())+":"+(0==i.getMinutes()?"00":i.getMinutes())+"</span> ":i&&e?i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear()+" "+(0==i.getHours()?"00":i.getHours())+":"+(0==i.getMinutes()?"00":i.getMinutes()):""},this.lista_actividades()};
