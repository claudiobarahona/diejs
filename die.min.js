if(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},"undefined"==typeof dieunah)var dieunah=new function(){this.nUnidades=0,this.nExamenes=0,this.urlRoot="",this.lista=[],this.dias=["Dom","Lun","Mar","Mié","Jue","Vie","Sab"],this.meses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],this.yaProcesado=!1,this.yaCalendarizado=[!0,!0],this.idCurso=window.location.pathname.match(/\/\d+\//)[0].match(/\d+/)[0];var t=this;this.bloquear_pantalla=function(){$.blockUI({css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"},message:"Por favor espere..."})},this.lista_actividades=function(){var a=String(window.location.href.match(/.*file.php/));return t.urlRoot=a.substring(0,a.length-9),$.get(t.urlRoot+"/course/view.php?id="+t.idCurso+"&parametroDEGT=quitar",function(a,e){var s=new RegExp("id=([0-9]+)");"error"==e?alert("Problema con la conexión de internet (error: 1)"):"timeout"==e?alert("Problema con la conexión de internet (error: 2)"):"parsererror"==e&&alert("Problema con el formato de conexión de internet (error: 3)"),resultado=a,t.lista.push({id:"u0t0a0_participantes",modID:0,titulo:"Participantes",url:t.urlRoot+"/user/index.php?id="+t.idCurso}),t.lista.push({id:"u0t0a0_calificaciones",modID:0,titulo:"Calificaciones",url:t.urlRoot+"/grade/report/index.php?id="+t.idCurso}),t.lista.push({id:"u0t0a0_novedades",modID:0,titulo:$('li[id=section-0] a:contains("Novedades")',a).text(),url:$('li[id=section-0] a:contains("Novedades")',a).attr("href")}),t.lista.push({id:"u0t0a0_consultas",modID:0,titulo:$('li[id=section-0] a:contains("Consulta")',a).text(),url:$('li[id=section-0] a:contains("Consulta")',a).attr("href")}),t.lista.push({id:"u0t0a0_presentacion",modID:0,titulo:$('li[id=section-0] a:contains("Presenta")',a).text(),url:$('li[id=section-0] a:contains("Presenta")',a).attr("href")}),t.lista.push({id:"u0t0a0_cafeteria",modID:0,titulo:$('li[id=section-0] a:contains("Cafe")',a).text(),url:$('li[id=section-0] a:contains("Cafe")',a).attr("href")}),t.lista.push({id:"u0t0a0_salir",modID:0,titulo:"Salir",url:t.urlRoot+"/my/"}),$("li[id^=section-]",a).each(function(){if("section-0"==$(this).attr("id"))return!0;var i=$(".summary",this).text().trim().toLowerCase().match(/unidad\s*\d+/);if(null===i){var i=$(".summary",this).text().trim().toLowerCase().match(/unidad/);null===i||t.nUnidades++}else nUnidad=parseInt(i[0].match(/\d+/)),t.nUnidades=nUnidad;var a=0,e=1;$("li",this).each(function(){if(0==$(".contentwithoutlink ",this).length&&0==$("a.dimmed",this).length){var i="u"+t.nUnidades+"t"+a+"a"+e;0==$('a:contains("_noact")',this).length&&(0==$('a:contains("Examen")',this).length&&0==$('a:contains("Recupera")',this).length&&0==$('a:contains("Repos")',this).length?(e++,t.lista.push({id:i,modID:s.exec($("a",this).attr("href"))[1],titulo:$(this).text().trim(),url:$("a",this).attr("href"),puntos:0,fInicio:0,fFinal:0})):(t.nExamenes++,t.lista.push({id:"u0t0a0_e"+t.nExamenes,modID:s.exec($("a",this).attr("href"))[1],titulo:$(this).text().trim(),url:$("a",this).attr("href"),puntos:0,fInicio:0,fFinal:0})))}else $(".contentwithoutlink ",this).length>0&&0==$("a.dimmed",this).length&&(a=parseInt($(this).text().match(/\d+/)[0]),e=1)})}),setTimeout($.unblockUI,100),t.yaProcesado=!0,$.get(t.urlRoot+"/report/editdates/index.php?id="+t.idCurso+"&activitytype=assign",function(a,e){t.ObtenerFechas(a);var s=[];for($("form[id=activitytypeform] div select option",a).each(function(){"selected"!=$(this).attr("selected")&&s.push($(this).attr("value"))}),i=0;i<s.length;i++)"resource"!=s[i]&&"label"!=s[i]&&"url"!=s[i]&&(t.yaCalendarizado.push(!0),$.get(t.urlRoot+"/report/editdates/index.php?id="+t.idCurso+"&activitytype="+s[i],function(i,a){t.ObtenerFechas(i),t.yaCalendarizado.pop()},"html"));t.yaCalendarizado.pop()},"html"),$.get(t.urlRoot+"/grade/report/user/index.php?id="+t.idCurso,function(i,a){var e,s=/(\d?\.?\d+$)/,n=new RegExp("id=([0-9]+)");$("th[class*='item']",i).each(function(){var a=n.exec($("a",this).attr("href"));$("td[headers$='"+$(this).attr("id")+" range']",i).each(function(){var i=$(this).text();e=s.exec(i);var n=t.actividad_por_modID(a[1]);t.lista[n].puntos=e[1]})}),t.yaCalendarizado.pop()},"html"),$("body").append('<div id="hotpt85469" style="background-color:#000;width:10px; height:10px; display:block; position:absolute; bottom:0px; left:0px"></div>'),$("#hotpt85469").click(function(i){i.shiftKey&&i.ctrlKey&&i.altKey&&$.colorbox({html:t.HTML_lista_actividades()})})},"html"),t.lista},this.CalendarizacionLista=function(){return 0==t.yaCalendarizado.length?!0:!1},this.ObtenerFechas=function(i){var a=!0,e=new RegExp("_([0-9]+)_"),s=new RegExp("_(allowsubmissionsfromdate|duedate|cutoffdate|timeopen|timeclose|assesstimestart|assesstimefinish)");if($('div[id^="fitem_id_date_mod_"]',i).each(function(){a=!1;var i=String($(this).attr("id")).substring(6),n=$('select[id="'+i+'_month"] option[selected=selected]',this).attr("value");n=n+"/"+$('select[id="'+i+'_day"] option[selected=selected]',this).attr("value"),n=n+"/"+$('select[id="'+i+'_year"] option[selected=selected]',this).attr("value"),n=n+" "+$('select[id="'+i+'_hour"] option[selected=selected]',this).attr("value"),n=n+":"+$('select[id="'+i+'_minute"] option[selected=selected]',this).attr("value");var r=new Date(n),d=t.actividad_por_modID(e.exec(i)[1]),o="";if(o=null==s.exec(i)[1]?!1:s.exec(i)[1],d&&o)switch(o){case"allowsubmissionsfromdate":t.lista[d].fInicio=r;break;case"timeopen":t.lista[d].fInicio=r;break;case"assesstimestart":t.lista[d].fInicio=r;break;case"duedate":t.lista[d].fFinal=r;break;case"timeclose":t.lista[d].fFinal=r;break;case"assesstimefinish":t.lista[d].fFinal=r;break;case"cutoffdate":}}),a){var n=/id_date_mod_(\d+)_(\w+)_(day|month|year|hour|minute)">[^<]+<\/label>(\d+|\w+)/g;$("div[class^=felement]",i).each(function(){for(var i=new Date,a=0,e="";null!=(m=n.exec($(this).html()));)switch(m.index===n.lastIndex&&n.lastIndex++,a=m[1],e=m[2],m[3]){case"day":i.setDate(m[4]);break;case"month":i.setMonth(t.strMes_nMes(m[4]));break;case"year":i.setFullYear(m[4]);break;case"hour":i.setHours(m[4]);break;case"minute":i.setMinutes(m[4])}var s=t.actividad_por_modID(a);if(s&&a>0)switch(e){case"allowsubmissionsfromdate":t.lista[s].fInicio=i;break;case"timeopen":t.lista[s].fInicio=i;break;case"assesstimestart":t.lista[s].fInicio=i;break;case"duedate":t.lista[s].fFinal=i;break;case"timeclose":t.lista[s].fFinal=i;break;case"assesstimefinish":t.lista[s].fFinal=i;break;case"cutoffdate":}})}return!0},this.strMes_nMes=function(t){var i=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre","ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic","january","february","march","april","may","june","july","august","september","october","november","december"];return i.indexOf(String(t).toLowerCase())%12},this.HTML_lista_actividades=function(){var a="";for(a+="<table border='1' align='center' cellpadding='5' cellspacing='0' class='tablactividades' width='800px'>",a+="<tr><td>id</td><td>modID</td><td>Unidad</td><td>Tema</td><td>Actividad</td><td>Titulo</td><td>Url</td><td>Puntos</td><td>Inicio</td><td>Fin</td></tr>",i=0;i<t.lista.length;i++)a+="<tr><td>"+t.lista[i].id+"</td><td>"+t.lista[i].modID+"</td><td>"+t.lista[i].id.match(/u\d+/)+"</td><td>"+t.lista[i].id.match(/t\d+/)+"</td><td>"+t.lista[i].id.match(/a\d+/)+"</td><td>"+t.lista[i].titulo+"</td><td>"+t.lista[i].url+"</td><td>"+t.lista[i].puntos+"</td><td>"+t.lista[i].fInicio+"</td><td>"+t.lista[i].fFinal+"</td></tr>";return a+="</table>"},this.actividad_por_modID=function(a){for(i=0;i<t.lista.length;i++)if(t.lista[i].modID==a)return i;return!1},this.actividad_por_id=function(a){for(i=0;i<t.lista.length;i++)if(t.lista[i].id==a)return t.lista[i];return!1},this.HTML_actividad_por_id=function(t){var i=this.actividad_por_id(t),a="";return a=0==i?"ERROR: "+t+" actividad no presente":"<a href='#' onClick='parent.$.colorbox({href:\""+i.url+'",width:"95%", height:"95%", iframe:true}); return false;\'>'+i.titulo+"</a>"},this.actividades_de_tema=function(a,e){var s=[];for(i=0;i<t.lista.length;i++){var n="u"+a+"t"+e,r=t.lista[i].id;r.substr(0,n.length)==n&&s.push(t.lista[i])}return 0==s.length?!1:s},this.LimpiarActividadMoodle=function(){$(".cboxIframe").contents().find("#page-header").css("display","none"),$(".cboxIframe").contents().find(".navbar-inner").css("display","none"),$(".cboxIframe").contents().find("#block-region-side-pre").css("display","none"),$(".cboxIframe").contents().find("#block-region-side-post").css("display","none"),$(".cboxIframe").contents().find("#region-main").css("width","100%"),$(".cboxIframe").contents().find("#page-footer").css("display","none"),$(".cboxIframe").contents().find("footer").css("display","none"),$(".cboxIframe").contents().find(".content-header").css("display","none"),$(".cboxIframe").contents().find(".navbar navbar-default navbar-fixed-top").css("display","none"),$(".cboxIframe").contents().find("#main-container").css("margin-left","0px"),$(".cboxIframe").contents().find("#sidebar").css("display","none"),$(".cboxIframe").contents().find(".col-md-4").css("display","none"),$(".cboxIframe").contents().find(".breadcrumb breadcrumb-top").css("display","none")},this.HTML_actividades_de_tema=function(t,a,e){var s=this.actividades_de_tema(t,a);"undefined"==typeof e&&(e=[]);var n="";if(n="<table border='0' align='center' cellpadding='10' cellspacing='10' class='tablactividades'>",0==s)n+="<tr><td>No hay actividades en este tema.</td></tr>";else for(i=0;i<s.length;i++)n+="<tr><td><a href='#' onClick='parent.$.colorbox({href:\""+s[i].url+'",width:"95%", height:"95%", iframe:true,onComplete:function(){ parent.$( ".cboxIframe" ).load(function(){parent.dieunah.LimpiarActividadMoodle(".cboxIframe")});}});return false;\'>',n+=s[i].titulo,n+="</a></td></tr>";if(e.length>0)for(j=0;j<e.length;j++)n+="<tr><td><a href='#' onClick='parent.$.colorbox({href:\"../unidad_"+t+"/t"+a+"_autoevaluacion"+(j+1)+'.html",width:"95%", height:"95%", iframe:true}); return false;\'>',n+=e[j],n+="</a></td></tr>";return n+="</table>"},this.GenerarCalendario=function(){var i="",a=0,e=0,s=0,n="",r="",d=0,o=0,l=0,c=0,u=[],h=[];for(i='<table class="tabla_calendario" border="0" cellpadding="10px" cellspacing="0" align="center"><tr style="text-align:center" class="titulo"><td>Unidad</td><td>Tema</td><td>Actividad</td><td>Valor</td><td>Fecha</td></tr>',p=0;p<t.lista.length;p++)if(a=parseInt(String(this.lista[p].id.match(/u\d+/)).substring(1)),e=p<t.lista.length-1?parseInt(String(this.lista[p+1].id.match(/u\d+/)).substring(1)):a+1,d=parseInt(String(this.lista[p].id.match(/t\d+/)).substring(1)),a>s&&(o=0),0!=a)o++,1==o?(c>d&&l>1&&(u.push("u"+s+"t"+c),h.push(l)),l=1,c=d,n="Unidad "+a+"</td><td"+(a%2==1?" class='tema_impar' ":" class='tema_par' ")+" id='u"+a+"t"+d+"'>Tema "+d+"</td><td> <a href='"+this.lista[p].url+"'>"+this.lista[p].titulo+"</a></td><td align='center'>"+(0==this.lista[p].puntos?"No se califica":this.lista[p].puntos)+"</td><td>"+t.FechaCadena(this.lista[p].fInicio)+"<br>"+t.FechaCadena(this.lista[p].fFinal)+"</td></tr>"):(c==d?(r+="<tr"+(a%2==1?" class='impar' ":" class='par' ")+"><td> <a href='"+this.lista[p].url+"'>"+this.lista[p].titulo+"</a></td><td align='center'>"+(0==this.lista[p].puntos?"No se califica":this.lista[p].puntos)+"</td><td>"+t.FechaCadena(this.lista[p].fInicio)+"<br>"+t.FechaCadena(this.lista[p].fFinal)+"</td></tr>",l++):(l>=2&&(u.push("u"+a+"t"+c),h.push(l)),r+="<tr"+(a%2==1?" class='impar' ":" class='par' ")+"><td"+(a%2==1?" class='tema_impar' ":" class='tema_par' ")+" id='u"+a+"t"+d+"' rowspan='1'>Tema "+d+"</td><td> <a href='"+this.lista[p].url+"'>"+this.lista[p].titulo+"</a></td><td align='center'>"+this.lista[p].puntos+"</td><td>"+t.FechaCadena(this.lista[p].fInicio)+"<br>"+t.FechaCadena(this.lista[p].fFinal)+"</td></tr>",l=1),p==t.lista.length-1&&l>=2&&(u.push("u"+a+"t"+c),h.push(l)),c=d),s=a,e!=a&&(i+="<tr"+(a%2==1?" class='impar' ":" class='par' ")+"><td "+(a%2==1?" class='unidad_impar' ":" class='unidad_par' ")+" rowspan='"+o+"'>"+n+r,r="");else{var f=parseInt(String(this.lista[p].id.match(/e\d+/)).substring(1));f>0&&(i+="<tr class='examen'><td colspan='3' class='exa_tit'>Examen "+f+"</td><td align='center'>"+(0==this.lista[p].puntos?"No se califica":this.lista[p].puntos)+"</td><td>"+t.FechaCadena(this.lista[p].fInicio)+"<br>"+t.FechaCadena(this.lista[p].fFinal)+"</td></tr>")}i+="</table>";for(var p=0;p<u.length;p++)i=i.replace("id='"+u[p]+"'","rowspan='"+h[p]+"'");return i},this.FechaCadena=function(i){return i?"<span class='dia'>"+t.dias[i.getDay()]+"</span>, "+i.getDate()+" "+t.meses[i.getMonth()]+" <span class='agno'>"+i.getFullYear()+"</span> - <span class='hora'>"+i.getHours()+":"+i.getMinutes()+"</span>":""},this.lista_actividades()};
